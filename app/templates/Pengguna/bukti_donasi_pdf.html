<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Bukti Donasi Buku</title>
  <style>
    @page {
      size: A4;
      margin: 2cm;
    }

    body {
      font-family: 'Helvetica', 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
      font-size: 11pt;
    }

    .header {
      position: relative;
      display: flex;
      align-items: flex-start;
      border-bottom: 2px solid #000;
      padding: 15px 80px 10px 80px;
      margin-top: -10px;
      min-height: 80px;
    }
    .header img.logo {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 60px;
      height: 60px;
      object-fit: contain;
      z-index: 2;
    }
    .header .header-text {
      text-align: center;
      flex-grow: 1;
      margin: 0 auto;
    }
    .header .line-1 {
      font-size: 14pt;
      font-weight: bold;
    }
    .header .line-2 {
      font-size: 16pt;
      font-weight: bold;
    }
    .header .contact-info {
      font-size: 9pt;
      margin-top: 5px;
    }

    .document-title {
      text-align: center;
      font-size: 14pt;
      font-weight: bold;
      margin-top: 30px;
      margin-bottom: 30px;
      text-decoration: underline;
    }
    
    .info-section {
      margin-bottom: 20px;
    }
    .info-section h3 {
      font-size: 12pt;
      margin-top: 0;
      margin-bottom: 10px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }
    
    .detail-table {
      width: 100%;
      border-collapse: collapse;
    }
    .detail-table td {
      padding: 4px 0;
      font-size: 11pt;
    }
    .detail-table td:first-child {
      width: 25%;
      font-weight: bold;
    }

    .books-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .books-table th, .books-table td {
      border: 1px solid #666;
      padding: 8px;
      text-align: left;
    }
    .books-table th {
      background-color: #e9e9e9;
      font-weight: bold;
      text-align: center;
    }
    .books-table .total-row td {
      font-weight: bold;
      background-color: #f2f2f2;
    }
    .books-table .text-center {
      text-align: center;
    }

    .footer-note {
      margin-top: 30px;
      font-size: 10pt;
      text-align: center;
      font-style: italic;
      color: #555;
    }

    /* --- PERBAIKAN FINAL SIGNATURE (STACKED / BERTUMPUK) --- */
    .signature-section {
      text-align: right; /* Mendorong seluruh blok ke kanan */
      margin-top: 50px;
      page-break-inside: avoid;
    }
    .signature-box {
      display: inline-block; /* Agar bisa diatur oleh text-align parent */
      width: 250px;
      text-align: left;    /* Teks di dalam box tetap rata kiri */
    }
    /* Memberi jarak vertikal antara Kepala Dinas dan Donatur */
    .signature-box:first-child {
      margin-bottom: 40px; 
    }
    .signature-box .signature-name {
      margin-top: 60px;
      font-weight: bold;
      text-decoration: underline;
    }

  </style>
</head>
<body>

  <div class="header">
    <img src="file:///{{ logo_path.replace('\\','/') }}" alt="Logo" class="logo">
    <div class="header-text">
      <div class="line-1">DINAS KEARSIPAN DAN PERPUSTAKAAN</div>
      <div class="line-2">KABUPATEN LUMAJANG</div>
      <div class="contact-info">
        Jl. Hayam Wuruk No. 1 Kepuharjo, Kec. Lumajang 67313 | Telp: 085198151513 | Email: arsip.perpustakaan@lumajangkab.go.id
      </div>
    </div>
  </div>

  <div class="document-title">
    BUKTI DONASI BUKU
  </div>

  <div class="info-section">
    <h3>Informasi Donasi</h3>
    <table class="detail-table">
      <tr><td>Invoice</td><td>: {{ donasi.invoice }}</td></tr>
      <tr><td>Tanggal</td><td>: {{ donasi.created_at | format_id_date }}</td></tr>
      <tr><td>Status</td><td>: {% if donasi.status.lower() == 'pending' %}Dalam Pengiriman{% elif donasi.status.lower() == 'confirmed' %}Diterima{% else %}{{ donasi.status.title() }}{% endif %}</td></tr>
    </table>
  </div>
    
  <div class="info-section">
    <h3>Data Donatur</h3>
    <table class="detail-table">
      <tr><td>Nama</td><td>: {{ donasi.user.full_name }}</td></tr>
      <tr><td>Email</td><td>: {{ donasi.user.email }}</td></tr>
      <tr><td>WhatsApp</td><td>: {{ donasi.whatsapp }}</td></tr>
    </table>
  </div>

  <div class="info-section">
    <h3>Informasi Pengiriman</h3>
    <table class="detail-table">
      <tr><td>Metode Pengiriman</td><td>: {{ donasi.metode.title() }}</td></tr>
      {% if donasi.tanggal_pengiriman %}
      <tr><td>Tanggal Pengiriman</td><td>: {{ donasi.tanggal_pengiriman | format_id_date }}</td></tr>
      {% endif %}
      {% if donasi.bukti_pengiriman %}
      <tr>
        <td>Bukti Resi</td>
        <td>: <a href="http://localhost:5000/resi/{{ donasi.invoice }}">Lihat Bukti Resi</a></td>
      </tr>
      {% endif %}
    </table>
  </div>

  <div class="info-section">
    <h3>Rincian Buku yang Didonasikan</h3>
    <table class="books-table">
      <thead>
        <tr>
          <th style="width: 10%;">No</th>
          <th style="width: 70%;">Subjek Buku</th>
          <th style="width: 20%;">Jumlah</th>
        </tr>
      </thead>
      <tbody>
        {% for item in detail_buku %}
        <tr>
          <td class="text-center">{{ loop.index }}</td>
          <td>{{ item.subjek_nama }}</td>
          <td class="text-center">{{ item.jumlah }} buku</td>
        </tr>
        {% endfor %}
        <tr class="total-row">
          <td colspan="2" style="text-align: right; padding-right: 10px;"><b>Total Buku:</b></td>
          <td class="text-center"><b>{{ detail_buku|sum(attribute='jumlah') }} buku</b></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="footer-note">
    <p>Terima kasih atas partisipasi Anda dalam mendukung literasi di Kabupaten Lumajang. Buku yang Anda donasikan akan segera kami distribusikan ke perpustakaan desa yang membutuhkan.</p>
  </div>

  <div class="signature-section">
    <div class="signature-box">
      <p>Penanggung Jawab,</p>
      <div class="signature-name">Tutik Endriyani</div>
    </div>
  </div>

</body>
</html>