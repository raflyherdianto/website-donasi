{% extends "admin/base_admin.html" %}
{% from "admin/content_wrapper.html" import page_header, card %}

{% block title %}Dashboard Admin{% endblock %}

{% block content %}
{{ page_header("Dashboard Admin", "Selamat datang di panel admin perpustakaan desa, " + SessionManager.get_specific_user_data('full_name', 'admin')|default('Admin')) }}

<!-- STATISTIK -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
  <!-- Buku dari Pusat -->
  <div class="bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm text-gray-500">Buku dari Perpus Pusat</span>
      <i data-lucide="package" class="w-5 h-5 text-blue-600"></i>
    </div>
    <p class="text-3xl font-bold text-blue-700">{{ total_buku_pusat }}</p>
  </div>

  <!-- Donasi Buku Masuk -->
  <div class="bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm text-gray-500">Donasi Buku Masuk</span>
      <i data-lucide="gift" class="w-5 h-5 text-green-600"></i>
    </div>
    <p class="text-3xl font-bold text-green-700">{{ total_donasi_buku }}</p>
  </div>

  <!-- Kegiatan Tercatat -->
  <div class="bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm text-gray-500">Kegiatan Tercatat</span>
      <i data-lucide="activity" class="w-5 h-5 text-purple-600"></i>
    </div>
    <p class="text-3xl font-bold text-purple-700">{{ total_kegiatan }}</p>
  </div>

  <!-- Peningkatan Koleksi -->
  <div class="bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm text-gray-500">Peningkatan Koleksi</span>
      <i data-lucide="trending-up" class="w-5 h-5 {% if persentase_kenaikan_koleksi >= 0 %}text-green-600{% else %}text-red-600{% endif %}"></i>
    </div>
    <p class="text-xs text-gray-400 mt-1">vs bulan lalu</p>
    <p class="text-3xl font-bold {% if persentase_kenaikan_koleksi >= 0 %}text-green-700{% else %}text-red-700{% endif %}">
      {% if persentase_kenaikan_koleksi > 0 %}+{% endif %}{{ persentase_kenaikan_koleksi }}%
    </p>
    <p class="text-xs {% if persentase_kenaikan_koleksi >= 0 %}text-green-500{% else %}text-red-500{% endif %} mt-1">
      {% if persentase_kenaikan_koleksi > 0 %}
        <i data-lucide="arrow-up" class="w-3 h-3 inline mr-1"></i>Meningkat
      {% elif persentase_kenaikan_koleksi < 0 %}
        <i data-lucide="arrow-down" class="w-3 h-3 inline mr-1"></i>Menurun
      {% else %}
        <i data-lucide="minus" class="w-3 h-3 inline mr-1"></i>Tetap
      {% endif %}
    </p>
  </div>

  <!-- Kunjungan Bulan Ini -->
  <a href="{{ url_for('admin.kunjungan_analytics') }}" class="block bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition-all transform hover:-translate-y-1 cursor-pointer">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm text-gray-500">Kunjungan Bulan Ini</span>
      <i data-lucide="users" class="w-5 h-5 text-pink-600"></i>
    </div>
    <p class="text-xs text-gray-400 mt-1">{{ current_month_name }} {{ current_year }}</p>
    <p class="text-3xl font-bold text-pink-700">{{ total_kunjungan_bulan_ini }}</p>
    <p class="text-xs text-blue-500 mt-2 flex items-center">
      <i data-lucide="bar-chart-3" class="w-3 h-3 mr-1"></i>
      Lihat Detail Analytics
    </p>
  </a>

  <!-- TOMBOL TAMBAH KUNJUNGAN -->
  <div class="bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition relative group">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm text-gray-500">Kunjungan Hari Ini</span>
      <i data-lucide="plus-circle" class="w-5 h-5 text-orange-600 group-hover:rotate-90 transition-transform"></i>
    </div>
    <p class="text-xs text-gray-400 mt-1">{{ current_date_formatted }}</p>
    <p class="text-3xl font-bold text-orange-700">{{ total_kunjungan_hari_ini }}</p>
    <div class="flex gap-2 mt-3">
      <form action="{{ url_for('admin.tambah_kunjungan') }}" method="POST">
        <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm">+ Tambah</button>
      </form>
      <form action="{{ url_for('admin.kurangi_kunjungan') }}" method="POST">
        <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 text-sm">â€“ Kurangi</button>
      </form>
    </div>
  </div>
</div>

<!-- NOTIFIKASI -->
{% call card("Notifikasi Terbaru") %}
  <div class="flex items-center gap-2 mb-3">
    <i data-lucide="bell" class="w-5 h-5 text-yellow-500"></i>
    <span class="font-semibold text-gray-800">Notifikasi Terbaru</span>
  </div>
  <ul class="list-disc ml-6 text-gray-700 space-y-1">
    <li>{{ notif_koleksi_pending }}</li>
    <li>{{ notif_distribusi_pending }}</li>
    <li>{{ notif_kegiatan_blm_lengkap }}</li>
  </ul>
{% endcall %}
{% endblock %}
